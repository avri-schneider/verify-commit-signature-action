name: Verify commits
on:
  pull_request:
    types: [opened, synchronize]
jobs:
  verify-commits:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        ref: ${{ github.event.pull_request.head.sha }}
    - name: Import certificates
      run: |
        for dir in $(ls .GITHUB_SIGNATURE_VERIFICATION); do
          echo "Importing certificates from directory $dir"
          for file in $(ls .GITHUB_SIGNATURE_VERIFICATION/$dir); do
            echo "Importing certificate $file"
            gpg --import .GITHUB_SIGNATURE_VERIFICATION/$dir/$file
          done
        done

    - name: "Verify commits"
      uses: avri-schneider/verify-commit-signature-action@main
      with:
        USERS_DIR: '.GITHUB_SIGNATURE_VERIFICATION'
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
